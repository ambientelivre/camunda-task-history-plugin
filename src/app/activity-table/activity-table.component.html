<ng-template #taskTableHeader>
  <tr>
    <th>Tarefa</th>
    <th>Assignee</th>
    <th>Inicio</th>
    <th>Fim</th>
    <th>Duração</th>
    <th>Eventos</th>
  </tr>
</ng-template>

<ng-template #processDetailTableHeader>
  <tr>
    <th>Ação</th>
    <th>Variavel</th>
    <th>Valor</th>
    <th>Criação</th>
    <th>Remoção</th>
  </tr>
</ng-template>

<ng-template #processDetailTableBody>
  <tr *ngFor="let d of processInstanceDetail$ | async">
    <td>{{ d.type }}</td>
    <td>{{ d.variableName || d.fieldId }}</td>
    <td>
      <ngx-json-viewer
        [expanded]="false"
        [json]="d.value || d.fieldValue"
      ></ngx-json-viewer>
    </td>
    <td>{{ d.time | date : "M/d/yy, h:mm:ss" }}</td>
    <td>{{ d.removalTime }}</td>
  </tr>
</ng-template>

<ng-template #taskTableBody>
  <tr *ngFor="let t of taskProcessInstance$ | async">
    <td>{{ t.name }}</td>
    <td>
      <div class="flex gap-3">
        {{ t.assignee
        }}<b *ngIf="t.user as u" class="flex gap-3"
          >{{ u.firstName }} {{ u.lastName }}</b
        >
      </div>
    </td>
    <td>{{ t.startTime | date : "M/d/yy, h:mm:ss" }}</td>
    <td>{{ t.endTime | date : "M/d/yy, h:mm:ss" }}</td>
    <td>{{ t.duration | durationFormat : "ms" : "hhmmss" }}</td>
    <td class="p-0">
      <table class="table">
        <thead>
          <ng-template
            *ngTemplateOutlet="processDetailTableHeader"
          ></ng-template>
        </thead>

        <tbody>
          <tr *ngFor="let d of t.detail">
            <td>{{ d.type }}</td>
            <td>{{ d.variableName || d.fieldId }}</td>
            <td>
              <ngx-json-viewer
                [expanded]="false"
                [json]="d.value || d.fieldValue"
              ></ngx-json-viewer>
            </td>
            <td>{{ d.time | date : "M/d/yy, h:mm:ss" }}</td>
            <td>{{ d.removalTime }}</td>
          </tr>
        </tbody>
      </table>
    </td>
  </tr>
</ng-template>

<ng-template #variableTableHeader>
  <tr>
    <th>Variavel</th>
    <th>Valor</th>
    <th>Ação</th>
    <th>Criação</th>
    <th>Remoção</th>
  </tr>
</ng-template>

<ng-template #variableTableBody>
  <tr *ngFor="let v of variableCreation$ | async">
    <td>{{ v.name }}</td>
    <td>
      <ngx-json-viewer [expanded]="false" [json]="v.value"></ngx-json-viewer>
    </td>
    <td>{{ v.state }}</td>
    <td>{{ v.createTime | date : "M/d/yy, h:mm:ss" }}</td>
    <td>{{ v.removalTime | date : "M/d/yy, h:mm:ss" }}</td>
  </tr>
</ng-template>

<tabset>
  <tab heading="Tarefas">
    <custom-table
      [thead]="taskTableHeader"
      [tbody]="taskTableBody"
    ></custom-table>
  </tab>

  <tab heading="Processo">
    <custom-table
      [thead]="processDetailTableHeader"
      [tbody]="processDetailTableBody"
    ></custom-table>
  </tab>

  <tab heading="Variaveis"
    ><custom-table
      [thead]="variableTableHeader"
      [tbody]="variableTableBody"
    ></custom-table>
  </tab>
</tabset>
